<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprar Agora - Pack Simplo</title>
    <!-- Tailwind via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        infinite: '#00E88F', // Verde assinatura da InfinitePay
                        infiniteDark: '#00c578',
                    }
                }
            }
        }
    </script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="bg-gray-100 text-gray-900 font-sans antialiased min-h-screen flex flex-col items-center p-4 pt-10">

    <!-- Card Principal -->
    <main
        class="w-full max-w-sm bg-white rounded-[24px] shadow-2xl p-8 flex flex-col items-center text-center relative overflow-hidden transition-all border border-gray-100">

        <!-- Header -->
        <h1 class="text-3xl font-black tracking-tighter text-gray-900 mb-1 leading-none uppercase">Pack Simplo <span
                class="text-infinite">2026</span></h1>
        <p class="text-gray-500 font-semibold text-sm mb-8 tracking-wide">Esquemas Elétricos Resumidos</p>

        <!-- Preço Agressivo -->
        <div class="mb-8 w-full bg-gray-50 py-4 px-6 rounded-2xl border border-gray-100 flex flex-col items-center">
            <span class="text-xs font-bold text-red-500 uppercase tracking-widest mb-1 flex items-center gap-1">
                <i data-lucide="flame" class="w-3 h-3"></i> Oferta Limitada
            </span>
            <div class="flex items-start justify-center text-gray-900">
                <span class="text-xl font-bold mt-2 mr-1 text-gray-400">R$</span>
                <span class="text-7xl font-black tracking-tighter leading-none">21</span>
                <span class="text-2xl font-bold mt-1">,49</span>
            </div>
            <span class="text-gray-400 text-sm font-medium line-through mt-2 dec">De R$ 97,00</span>
        </div>

        <!-- Botão de Compra -->
        <button id="buyBtn" onclick="processPayment()"
            class="w-full bg-infinite hover:bg-infiniteDark text-gray-900 text-lg font-black uppercase py-5 rounded-2xl shadow-[0_10px_20px_rgba(0,232,143,0.3)] transition-transform hover:scale-[1.03] active:scale-95 flex items-center justify-center gap-2 mb-4 relative overflow-hidden">
            <span id="btnText" class="flex items-center gap-2 relative z-10"><i data-lucide="zap" class="w-5 h-5"></i>
                COMPRAR AGORA</span>
            <div id="btnLoader"
                class="hidden absolute w-6 h-6 border-4 border-gray-900/20 border-t-gray-900 rounded-full animate-spin z-10">
            </div>

            <!-- Shimmer Effect -->
            <div
                class="absolute inset-0 -translate-x-full bg-gradient-to-r from-transparent via-white/40 to-transparent hover:animate-[shimmer_1.5s_infinite]">
            </div>
        </button>

        <!-- Gatilho de Segurança & Entrega -->
        <div class="flex flex-col gap-2 w-full mt-2">
            <div
                class="flex items-center gap-2 text-xs font-bold text-gray-600 bg-gray-100/80 px-4 py-2.5 rounded-xl w-full justify-center">
                <i data-lucide="check-circle-2" class="w-4 h-4 text-green-500"></i>
                Liberação automática após o PIX
            </div>
        </div>

    </main>

    <!-- Footer Segurança -->
    <div class="mt-8 flex items-center gap-2 text-gray-400 text-xs font-semibold uppercase tracking-widest opacity-80">
        <i data-lucide="shield-check" class="w-4 h-4"></i>
        Pagamento Seguro por InfinitePay
    </div>

    <!-- Script de Integração API -->
    <script>
        lucide.createIcons(); // Carrega os ícones Lucide

        async function processPayment() {
            const btn = document.getElementById('buyBtn');
            const btnText = document.getElementById('btnText');
            const btnLoader = document.getElementById('btnLoader');

            // Feedback visual: Oculta texto e gira Loader
            btn.disabled = true;
            btnText.classList.add('opacity-0');
            btnLoader.classList.remove('hidden');

            try {
                // Post para a nossa Rota Proxy Interna (100% livre de CORS e com o Payload protegido no Backend)
                const response = await fetch("/api/infinite/create", {
                    method: 'POST'
                });

                // Tenta extrair JSON (tanto em sucesso ou erro para debug)
                const data = await response.json().catch(() => null);

                if (!response.ok) {
                    throw new Error(data && data.message ? data.message : "Erro desconhecido na InfinitePay");
                }

                if (data && data.url) {
                    // Mágica acontece aqui: Redirecionamento instantâneo
                    window.location.href = data.url;
                } else {
                    throw new Error("URL não retornada pela InfinitePay");
                }

            } catch (error) {
                console.error("[InfinitePay Error]:", error);

                let errorMsg = error.message;
                // Exemplo: Erro Clássico de CORS no navegador (Se a Infinite bloquear chamadas Frontend nesse Endpoint novo deles)
                if (errorMsg.includes("Failed to fetch") || errorMsg.includes("NetworkError")) {
                    errorMsg = "O navegador bloqueou a requisição direta (CORS). Se isso ocorrer, precisamos usar a rota Proxy via Next.js assim como fizemos na BytePay.";
                }

                alert("Ops! Falha ao gerar link de pagamento: \n" + errorMsg);

                // Restaura botão
                btn.disabled = false;
                btnText.classList.remove('opacity-0');
                btnLoader.classList.add('hidden');
            }
        }
    </script>
    <style>
        @keyframes shimmer {
            100% {
                transform: translateX(100%);
            }
        }
    </style>
</body>

</html>